angular.module("mainModule",["gettext","ui.utils","ui.router","angularMoment","ngMaterial","md.data.table","angular-loading-bar","templates","angular-cache","duScroll","ngFileUpload","vcRecaptcha","ngFileSaver"]).value("duScrollDuration",3e3).config(["$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider",function(a,b,c,d){d.html5Mode(!0),a.state("cheque",{"abstract":!0,url:"/cheques",views:{header:{controller:["$rootScope","$scope","$state",function(a,b,c){b.selectedTab=c.current.data.selectedTab,a.$on("$stateChangeSuccess",function(a,c,d,e,f){b.selectedTab=c.data.selectedTab})}],template:'<header selected-tab="selectedTab"></header>'},content:{template:"<ui-view></ui-view>"}}}).state("cheque.filter",{url:"^/filter",template:"<filters-page></filters-page>",data:{selectedTab:0}}).state("cheque.edit",{url:"^/cheque/{chequeId:[0-9]{1,10}}",controller:["$scope","$stateParams",function(a,b){a.chequeID=b.chequeId}],template:'<cheque-page cheque-id="chequeID"></cheque-page>',data:{selectedTab:1}}).state("cheque.create",{url:"^/cheque",template:"<cheque-page></cheque-page>",data:{selectedTab:1}}).state("cheque.dashboard",{url:"^/dashboard",template:"<dashboard></dashboard>",data:{selectedTab:2,access:["ROLE_ADMIN","ROLE_BOSS","ROLE_ENGINEER"]}}).state("cheque.analytics",{url:"^/analytics",template:"<analytics-page></analytics-page>",data:{selectedTab:3,access:["ROLE_ADMIN","ROLE_BOSS"]}}).state("cheque.profile",{url:"^/profile",template:"<profile-page></profile-page>",data:{selectedTab:4,access:["ROLE_ADMIN"]}}).state("cheque.login",{url:"^/login",template:"<login-page></login-page>",data:{selectedTab:5}}),c.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",c.interceptors.push(["$q","$injector",function(a,b){return{responseError:function(c){if(-1===c.status){var d=b.get("warning");return d.showServerConnectionLostException(),a.reject(c)}if(403===c.status){var e=b.get("$http"),f=a.defer();return e.get("/api/test").then(f.resolve,f.reject),f.promise.then(function(){return e(c.config)})}if("org.springframework.orm.ObjectOptimisticLockingFailureException"===c.data.exception){var d=b.get("warning");return d.showAlertOptimisticLockingException(),a.reject(c)}return a.reject(c)}}}])}]).config(["$mdThemingProvider",function(a){a.theme("default").primaryPalette("grey",{"default":"900"}).accentPalette("blue-grey",{"default":"900"}),a.theme("inner-block").primaryPalette("grey",{"default":"50"}),a.theme("header").primaryPalette("grey",{"default":"50"}).accentPalette("blue-grey",{"default":"50"}).dark()}]).config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1,a.latencyThreshold=100}]).config(["$mdDateLocaleProvider",function(a){a.months="январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_"),a.shortMonths="янв_фев_март_апр_май_июнь_июль_авг_сен_окт_ноя_дек".split("_"),a.days="воскресенье_понедельник_вторник_среда_четверг_пятница_суббота".split("_"),a.shortDays="вс_пн_вт_ср_чт_пт_сб".split("_"),a.firstDayOfWeek=1}]).run(["gettextCatalog","amMoment","auth","security","autocomplete","$rootScope",function(a,b,c,d,e,f){c.init(),d.init(),a.setCurrentLanguage("ru"),b.changeLocale("ru"),e.getDataFromServer("users"),f.tableFilter={order:"-id",limit:15,page:1}}]),angular.module("gettext").run(["gettextCatalog",function(a){a.setStrings("ru",{Address:"Адрес","Change cheque №":"Изменить расписку №",notes:"Специальные отметки","new cheques":"Новые расписки",Customer:"Заказчик",Email:"Почта",Guarantee:"Гарантия (д/н)",help:"Помощь",Home:"Главная",Id:"№",Inspector:"Принял",Introduced:"Прием",IntroducedFrom:"Принят с",IntroducedTo:"Принят по",Issued:"Выдан (д/н)","Is Issued":"Выдан",Kits:"Комплект",Malfunction:"Неисправность",master:"Инженер",Model:"Модель","Modify Check":"Править","Name of Product":"Наименование",No:"Нет","Number of pages":"Количество страниц",Phone:"Телефон",profile:"Профиль",Purchaser:"Сдал",Ready:"Готов (д/н)","Is Ready":"Готов","Repair Period":"Срок ремонта",Send:"Добавить","Serial Number":"Серийный номер",settings:"Настройки","Special Notes":"Особые отметки",diagnostics:"Диагностика",Yes:"Да",Filters:"Фильтры",Checks:"Расписки",Create:"Создать","Change cheque":"Изменить расписку",Now:"Сейчас",Cancel:"Закрыть",save:"Применить",Cheque:"Расписка",added:"добавлена",modified:"изменена",deleted:"удалена","Has guarantee":"Есть гарантия",Warranty:"Гарантия","Has no guarantee":"Нет гарантии","Not ready":"Не готов","Not issued":"Не выдан","Rows per page:":"Строк на странице:",of:"из",tasks:"Задачи",login:"Войти",logout:"Выйти",tasks:"Задачи",analytics:"Аналитика",synchronize:"Синхронизировать","synchronized":"синхронизирована","enter date":"Введите дату",cheque:"Расписка",Paid:"Оплачен (д/н)","Is Paid":"Оплачен","Not Paid":"Не оплачен",payment:"Оплата",repair:"Ремонт",zip:"ЗИП",deliver:"Доставка",prepayment:"Предоплата",type:"Тип",description:"Описание",cost:"Стоимость",currency:"Валюта",sum:"Сумма","sum with prepayment":"Сумма с предоплатой","estimated cost":"Ориентировочная цена","currency rates":"Курс валют","show more":"Показать ещё","roll up":"Свернуть",authorization:"Авторизация",username:"Логин",password:"Пароль",users:"Пользователи","cheques with delay":"Расписки с просрочкой","new cheque":"Новая расписка",photographies:"Фотографии","drop photographies here":"Поместите фотографии сюда","would you like to continue without saving changes?":"Выйти без сохранения изменений?","if you do not save your changes, then all the information will be lost":"Если не сохранить изменения, то вся информация будет потеряна","continue":"Продолжить",cancel:"Отмена","would you like to delete payment?":"Удалить счет?","deleted payment can not be recovered":"Удаленный счет невозможно восстановить","delete":"Удалить","would you like to delete comment?":"Удалить комментарий?","deleted comment can not be recovered":"Удаленный комментарий невозможно восстановить","would you like to delete cheque?":"Удалить расписку?","deleted cheque can not be recovered":"Удаленную расписку невозможно восстановить","would you like to delete photo?":"Удалить фото?","deleted photo can not be recovered":"Удаленное фото невозможно восстановить","payments synchronized":"Оплата синхронизирована","cheque has been changed":"Расписка была изменена другим пользователем","cheque has been changed by another user, please refresh the cheque and enter your changes again.":"Пожалуйста, обновите расписку и внесите свои изменения снова",find:"Найти",fullname:"Полное имя","new password":"Новый пароль","admin password":"Пароль администратора",enabled:"Включен","server connection lost title":"Соединение с сервером потеряно","server connection lost content":"Случилось страшное: сервер не отвечает на запросы. Попробуйте обновить страницу через несколько минут.",receipt:"принята",returnedToClientFrom:"Выдан с",returnedToClientTo:"Выдан по","Without Repair":"Без ремонта (д/н)","Is Without Repair":"Без ремонта","With Repair":"С ремонтом"})}]),angular.module("mainModule").controller("TimePicker",["$scope",function(a){a.$watch("time",function(b,c){void 0==b?(a.hours=void 0,a.minutes=void 0):(a.hours=moment(b).format("HH"),a.minutes=moment(b).format("mm"))}),a.$watch("hours",function(b,c){void 0!=b&&(a.time=moment(a.time).hours(b).format("YYYY-MM-DDTHH:mm:ssZZ"))}),a.$watch("minutes",function(b,c){void 0!=b&&(a.time=moment(a.time).minutes(b).format("YYYY-MM-DDTHH:mm:ssZZ"))})}]).directive("timePicker",function(){return{restrict:"E",controller:"TimePicker",scope:{time:"=ngModel"},require:"ngModel",templateUrl:"directives/time-picker/time-picker.html"}}),angular.module("mainModule").controller("DatePicker",["$scope",function(a){a.$watch("date",function(b,c){void 0==b?a.dateInner=void 0:a.dateInner=moment(b).toDate()}),a.$watch("dateInner",function(b,c){void 0!=b&&(a.date=moment(b).format("YYYY-MM-DDTHH:mm:ssZZ"))})}]).directive("datePicker",function(){return{restrict:"E",controller:"DatePicker",scope:{date:"=ngModel",disabled:"=ngDisabled",placeholder:"=mdPlaceholder"},require:["ngModel","ngDisabled"],templateUrl:"directives/date-picker/date-picker.html"}}),angular.module("mainModule").controller("DateTimePicker",["$scope",function(a){a.$watch("datetime",function(b,c){void 0==b?(a.datetimeinner=void 0,a.date=void 0,a.time=void 0):(a.date=moment(b).toDate(),a.time=moment(b).toDate())}),a.$watch("date",function(b,c){if(void 0!=b){var d=moment(a.datetime).hours(),e=moment(a.datetime).minutes();a.datetime=moment(b).hours(d).minutes(e).format("YYYY-MM-DDTHH:mm:ssZZ")}}),a.$watch("time",function(b,c){if(void 0!=b){var d=moment(b).hours(),e=moment(b).minutes();a.datetime=moment(a.datetime).hours(d).minutes(e).format("YYYY-MM-DDTHH:mm:ssZZ")}})}]).directive("dateTimePicker",function(){return{restrict:"E",controller:"DateTimePicker",scope:{datetime:"=ngModel",disableChequeForm:"=ngDisabled"},require:"ngModel",templateUrl:"directives/date-time-picker/date-time-picker.html"}}),angular.module("mainModule").controller("AnalyticsPage",["$scope","$http","FileSaver","Blob",function(a,b,c,d){a.columns=["engineers","brands"],a.rows=["date","cheques"],a.funds=["income","profit"],a.preferences={},a.analyticsHeader=[],a.getAnalytics=function(){b.post("/api/analytics",a.preferences,{responseType:"blob"}).success(function(a){var b=new d([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});c.saveAs(b,"analytics.xlsx")})}}]).directive("analyticsPage",function(){return{restrict:"E",controller:"AnalyticsPage",templateUrl:"app/analytics-page/analytics-page.html"}}),angular.module("mainModule").directive("printCheque",function(){return{restrict:"E",controller:["$scope",function(a){var b={office:{office:!0,tech:!1,client:!1},tech:{office:!1,tech:!0,client:!1},client:{office:!1,tech:!1,client:!0}};a.spec=b[a.specialization],a.getComponents=function(){var b=[];return a.cheque.components.forEach(function(a){b.push(a.name)}),b.join(", ")}}],scope:{cheque:"=ngModel",specialization:"=specialization"},require:["ngModel","specialization"],templateUrl:"app/cheque-page/print-cheque/print-cheque.html"}}),angular.module("mainModule").directive("filtersPage",function(){return{restrict:"E",templateUrl:"app/filters-page/filters-page.html"}}),angular.module("mainModule").controller("FilterForm",["$rootScope","$scope","$http","$timeout","$mdDialog","gettextCatalog","$q","cheque","autocomplete",function(a,b,c,d,e,f,g,h,i){b.filterForm={},b.getAutocompleteData=i.getDataFromServer,b.resetFilter=function(){a.filter=angular.copy({}),b.filterForm.$setPristine()},b.sendFilterPreferences=function(){a.tableFilter.page=1,h.getChequeListFromServer(a.filter)}}]).directive("filterForm",function(){return{restrict:"E",controller:"FilterForm",templateUrl:"app/filters-page/filter-form/filter-form.html"}}),angular.module("mainModule").controller("TableData",["$rootScope","$scope","$http","$timeout","$mdDialog","gettextCatalog","$state",function(a,b,c,d,e,f,g){b.label={page:"Страница",rowsPerPage:f.getString("Rows per page:"),of:f.getString("of")},b.onPageChange=function(){},b.onOrderChange=function(){},b.open=function(a,b){(2===a.which||1===a.which&&(a.metaKey||a.ctrlKey))&&window.open(g.href("cheque.edit",{chequeId:b},{absolute:!0}),"_blank")}}]).directive("tableData",function(){return{restrict:"E",controller:"TableData",templateUrl:"app/filters-page/table-data/table-data.html"}}),angular.module("mainModule").filter("filterByDateRange",[function(){return function(a,b,c){if(null==b&&null==c)return a;var d=null!=b?moment(b).unix():moment("1899-12-31T21:00:00.000Z").unix(),e=null!=c?moment(c).unix():moment("2999-12-31T21:00:00.000Z").unix(),f=null,g=[];return angular.forEach(a,function(a){f=moment(a.receiptDate).unix(),f>d&&e>f&&g.push(a)}),g}}]),angular.module("mainModule").filter("filterByID",[function(){return function(a,b){if(null==b||""==b)return a;var c=[];return angular.forEach(a,function(a){b==a.id&&c.push(a)}),c}}]),angular.module("mainModule").controller("Header",["$scope","currencyRatesService","$mdToast","$rootScope","auth","gettextCatalog","security",function(a,b,c,d,e,f,g){b.getCurrencyRate(),a.refreshCurrencyRates=function(){b.refreshCurrencyRate(),c.show(c.simple().content("Currency rates refreshed").position("top right").hideDelay(700))},a.authenticated=function(){return e.authenticated},a.profileName=function(){return d.user.principal&&d.user.principal.fullname?d.user.principal.fullname:f.getString("profile")},a.security=g,a.logout=e.logout}]).directive("header",function(){return{restrict:"E",controller:"Header",scope:{selectedTab:"=selectedTab"},require:"selectedTab",templateUrl:"app/header/header.html"}}),angular.module("mainModule").controller("CommentsBlock",["$scope","$http","$document","$rootScope","security","warning","cheque",function(a,b,c,d,e,f,g){a.comment=void 0,a.add=3,a.limit=3,a.bottomButton="show more",a.saveComment=function(){a.comment.user=d.user.principal,a.comment.cheque=a.cheque,b.post("/api/cheques/"+a.cheque.id+"/"+a.type,a.comment).success(function(){a.comment.text=void 0,a.commentsForm.$setPristine(),a.commentsForm.$setUntouched(),"diagnostics"===a.type&&g.getDiagnosticsFromServer(a.cheque.id),"notes"===a.type&&g.getNotesFromServer(a.cheque.id)})},a.deleteComment=function(c,d){f.showConfirmDeleteComment(d).then(function(){b["delete"]("/api/cheques/"+a.cheque.id+"/"+a.type+"/"+c).success(function(){"diagnostics"===a.type&&g.getDiagnosticsFromServer(a.cheque.id),"notes"===a.type&&g.getNotesFromServer(a.cheque.id)})},function(){})},a.addedLesserThanElem=function(){return a.cheque[a.type]?a.add<a.cheque[a.type].length:void 0};var h=function(){return a.limit<a.cheque[a.type].length};a.limitComments=function(){h()?a.limit+=a.add:a.limit=a.add,h()?a.bottomButton="show more":a.bottomButton="roll up"},a.$watch("commentsForm.$dirty",function(b,c){a.$parent.formDirty.comments=b}),a.security=e}]).directive("commentsBlock",[function(){return{restrict:"E",controller:"CommentsBlock",scope:{cheque:"=ngModel",type:"=type"},require:"ngModel",templateUrl:"app/cheque-page/comments-block/comments-block.html"}}]),angular.module("mainModule").controller("PaymentBlock",["$rootScope","$scope","currencyRatesService","security","warning","$http","$mdToast","gettextCatalog","cheque","$state",function(a,b,c,d,e,f,g,h,i,j){b.hasPrepayment=!1,b.balance={payments:[]},b.security=d,b.hasAtLeastOnePayment=function(){return b.balance.payments.length>0},b.synchronizeBalance=function(){i.syncChequeBalanceWithServer(b.chequeID,b.balance).then(function(a){a&&(b.paymentForm.$setPristine(),b.paymentForm.$setUntouched())})},b.addPayment=function(){void 0===b.balance.payments&&(b.balance.payments=[]),c.refreshCurrencyRate(),b.balance.payments.push({cost:0,currency:"rub",exchangeRate:a.currencyRates,user:a.user.principal})},b.delPayment=function(a,c){e.showConfirmDeletePayment(c).then(function(){b.balance.payments.splice(b.balance.payments.indexOf(a),1),b.paymentForm.$setDirty()},function(){})},b.sum=function(a,c){var d=0;return b.hasPrepayment=!1,void 0!=b.balance.payments&&b.balance.payments.forEach(function(e){void 0!=e.cost&&void 0!=e.currency&&("prepayment"!=e.type?d+=e.cost*e.exchangeRate[e.currency]/e.exchangeRate[a]:(b.hasPrepayment=!0,c&&(d-=e.cost*e.exchangeRate[e.currency]/e.exchangeRate[a])))}),d},b.$watch("paymentForm.$dirty",function(a,c){b.$parent.formDirty.payment=a}),a.$watch("balance",function(a,c){void 0!==a&&(b.balance=a)})}]).directive("paymentBlock",[function(){return{restrict:"E",controller:"PaymentBlock",scope:{chequeID:"=chequeId"},require:"chequeId",templateUrl:"app/cheque-page/payment-block/payment-block.html"}}]),angular.module("mainModule").controller("ChequeForm",["$scope","$http","gettextCatalog","$mdToast","$state","security","$rootScope","warning","$document","cheque","autocomplete","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l){a.disableChequeForm=!f.hasAnyRole(["ROLE_ADMIN","ROLE_BOSS","ROLE_SECRETARY"]),a.security=f,a.getAutocompleteData=k.getDataFromServer,a.currentDateIfEmpty=j.addToChequeCurrentDateIfEmpty,a.syncCheque=function(){j.syncChequeWithServer(a.cheque).then(function(b){b&&(a.chequeForm.$setPristine(),a.chequeForm.$setUntouched(),j.getChequeBalanceFromServer(g.cheque.id))})},a.deleteCheque=function(b){h.showConfirmDeleteCheque(b).then(function(){a.$parent.formDirty={payment:!1,cheque:!1},j.deleteChequeFromServer(a.cheque.id)},function(){})},a.addKit=function(a){return{name:a}},a.syncWithReadyStatus=function(){var b=a.cheque.withoutRepair;a.cheque.readyStatus=b,b===!0&&a.currentDateIfEmpty("readyDate","readyStatus")},a.syncWithWithoutRepairStatus=function(){var b=a.cheque.readyStatus,c=a.cheque.withoutRepair;b===!1&&c===!0&&(a.cheque.withoutRepair=b)},a.printCheque=function(){window.print()},l(function(){a.chequeForm.$setPristine(),a.$watch("chequeForm.$dirty",function(b,c){a.$parent.formDirty.cheque=b})},1e3)}]).directive("chequeForm",[function(){return{restrict:"E",controller:"ChequeForm",scope:{cheque:"=ngModel",hasID:"=hasId"},require:["ngModel","hasId"],templateUrl:"app/cheque-page/cheque-form/cheque-form.html"}}]),angular.module("mainModule").controller("PaymentLine",["$scope","$http","security",function(a,b,c){a.$watch("payment.type",function(b,c){a.hasPrepayment="prepayment"===b}),a.$watch("paid",function(b,c){a.paymentLineDisabled=b||!a.security.hasAnyRole(["ROLE_ADMIN","ROLE_BOSS"])&&!a.security.isSameUser(a.payment.user)}),a.toPay=function(b){return a.payment.cost*a.payment.exchangeRate[a.payment.currency]/a.payment.exchangeRate[b]},a.loadUsers=function(){b.get("/api/users").success(function(b){a.users=b})},a.hasPrepayment=!1,a.types=["repair","zip","deliver","prepayment"],a.currencies=["eur","uah","usd","rub"],a.security=c}]).directive("paymentLine",[function(){return{restrict:"E",controller:"PaymentLine",scope:{payment:"=payment",paid:"=paid"},require:["ngModel","paid"],templateUrl:"app/cheque-page/payment-block/payment-line/payment-line.html"}}]),angular.module("mainModule").controller("ChequePage",["$rootScope","$scope","$stateParams","$http","cheque","warning","$state",function(a,b,c,d,e,f,g){b.formDirty={payment:!1,cheque:!1,comments:!1},b.hasID=!!b.chequeID,b.hasID?(e.getChequeFromServer(b.chequeID),e.getChequeBalanceFromServer(b.chequeID),e.getPhotoListFromServer(b.chequeID)):e.createNewCheque(),b.$watch("cheque.id",function(a,c){b.hasID=!!a}),a.$watch("cheque",function(a,c){b.cheque=a,b.chequeID=a.id,b.hasID=!!a.id}),a.$on("$stateChangeStart",function(a,c,d,e,h){"cheque.edit"!==e.name&&"cheque.create"!==e.name||!(b.formDirty.cheque||b.formDirty.payment||b.formDirty.comments)||(a.preventDefault(),f.showConfirmUnsavedChanges().then(function(){b.formDirty={payment:!1,cheque:!1,comments:!1},g.go(c)},function(){}))})}]).directive("chequePage",function(){return{restrict:"E",controller:"ChequePage",scope:{chequeID:"=?chequeId"},templateUrl:"app/cheque-page/cheque-page.html"}}),angular.module("mainModule").controller("PhotoBlock",["$scope","Upload","$http","$state","$location","$rootScope","warning","cheque","$window","security",function(a,b,c,d,e,f,g,h,i,j){a.security=j,a.deletePhoto=function(b,d){g.showConfirmDeletePhoto(d).then(function(){c["delete"]("api/photo/"+a.chequeID+"/"+b).success(function(){h.getPhotoListFromServer(a.chequeID)})},function(){})},a.openPhoto=function(a){i.open("/api/photo/"+a,"_blank")},a.$watch("files",function(){a.upload(a.files)}),a.$watch("file",function(){null!=a.file&&(a.files=[a.file])}),a.upload=function(c){if(c&&c.length)for(var d=0;d<c.length;d++){var e=c[d];e.$error||b.upload({url:"/api/upload-image",data:{file:e,chequeID:a.chequeID,username:f.user.principal.username}}).success(function(){h.getPhotoListFromServer(a.chequeID)})}}}]).directive("photoBlock",[function(){return{restrict:"E",controller:"PhotoBlock",scope:{chequeID:"=chequeId"},require:"chequeId",templateUrl:"app/cheque-page/photo-block/photo-block.html"}}]),angular.module("mainModule").controller("ProfilePage",["$scope","$http","currencyRatesService",function(a,b,c){var d={username:"Name",fullname:"FullName",enabled:!0,authorities:[{authority:"ROLE_ENGINEER"}]};c.getListOfCurrencyRates().then(function(b){a.rates=b}),a.setRates=function(){c.setListOfCurrencyRates(a.rates)},a.getUsers=function(){b.get("/api/users").success(function(b){a.users=b})},a.addUser=function(){a.users.push(d)},a.getUsers()}]).directive("profilePage",function(){return{restrict:"E",controller:"ProfilePage",templateUrl:"app/profile-page/profile-page.html"}}),angular.module("mainModule").controller("CurrencyRateDay",["$scope","$http",function(a,b){a.sendRate=function(){b.post("/api/currency-rate",a.rate).success(function(){a.day.$setPristine()})}}]).directive("currencyRateDay",function(){return{restrict:"E",controller:"CurrencyRateDay",scope:{rate:"=ngModel"},require:"ngModel",templateUrl:"app/profile-page/currency-rate-day/currency-rate-day.html"}}),angular.module("mainModule").controller("UserDetails",["$scope","$http","currencyRatesService",function(a,b,c){a.saveUser=function(){b.post("/api/user",a.user).success(function(){a.$parent.getUsers()})},a.addAuthority=function(a){return{authority:a}}}]).directive("userDetails",function(){return{restrict:"E",controller:"UserDetails",scope:{user:"=ngModel"},require:"ngModel",templateUrl:"app/profile-page/user-details/user-details.html"}}),angular.module("mainModule").controller("LoginPage",["$scope","$rootScope","auth","$mdToast","vcRecaptchaService","autocomplete",function(a,b,c,d,e,f){a.credentials={},a.response=null,a.widgetId=null,a.model={key:"6Le_FBETAAAAABTCTvoZWEEIqb1lxqNpNAtRlGWk"},a.authenticated=function(){return c.authenticated},a.login=function(){c.authenticate(a.credentials,a.response).then(function(b){b?(f.getDataFromServer("users"),d.show(d.simple().content("Login succeeded").position("top right").hideDelay(700))):(d.show(d.simple().content("Login failed").position("top right").hideDelay(700)),e.reload(a.widgetId))})},a.logout=c.logout,a.hasAccess=function(c){var d=!1;return angular.forEach(b.user.authorities,function(a){a.authority===c&&(d=!0)}),d&&a.authenticated()},a.setResponse=function(b){a.response=b},a.setWidgetId=function(b){a.widgetId=b},a.cbExpiration=function(){a.response=null}}]).directive("loginPage",function(){return{restrict:"E",controller:"LoginPage",templateUrl:"app/login-page/login-page.html"}}),angular.module("mainModule").controller("Dashboard",["$scope","$stateParams","$http",function(a,b,c){c.get("/api/attention").success(function(b){a.attention=b}),c.get("/api/delay").success(function(b){a.delay=b})}]).directive("dashboard",function(){return{restrict:"E",controller:"Dashboard",templateUrl:"app/dashboard/dashboard.html"}}),angular.module("mainModule").service("currencyRatesService",["CacheFactory","$http","$q","$rootScope",function(a,b,c,d){var e;return a.get("currencyRatesCache")||a.createCache("currencyRatesCache",{deleteOnExpire:"aggressive",maxAge:288e5,recycleFreq:6e4,storageMode:"localStorage",onExpire:function(a,c){b.get(a).success(function(b){e.put(a,b)})}}),e=a.get("currencyRatesCache"),{getCurrencyRate:function(){b.get("/api/currency-rate",{cache:e}).success(function(a){d.currencyRates=a})},refreshCurrencyRate:function(){e.remove("/api/currency-rate"),this.getCurrencyRate()},getListOfCurrencyRates:function(){var a=c.defer();return b.get("/api/currency-rate-list").success(function(b){a.resolve(b)}),a.promise},setListOfCurrencyRates:function(a){b.post("/api/currency-rate-list",a)}}}]),angular.module("mainModule").factory("auth",["$rootScope","$http","$state","$q",function(a,b,c,d){a.user={};var e={authenticated:!1,loginState:"cheque.login",logoutPath:"/logout",desireState:"cheque.filter",desireParams:{},init:function(){e.authenticate({},{}).then(function(a){a||c.go(e.loginState)}),a.$on("$stateChangeStart",function(a,b,c,d,f){b.name===e.loginState||e.authenticated||(e.desireState=b.name,e.desireParams=c,a.preventDefault())})},authenticate:function(f,g){var h=d.defer(),i=f&&f.username?{Authorization:"Basic "+btoa(f.username+":"+f.password)}:{};return i.ReCaptcha=g,b.get("/api/user",{headers:i,params:{"remember-me":!0}}).success(function(b){a.user=b,e.authenticated=!!b.name,c.go(e.desireState,e.desireParams),h.resolve(e.authenticated)}).error(function(){h.resolve(!1),e.authenticated=!1}),h.promise},logout:function(){b.post(e.logoutPath,{}),e.authenticated=!1,a.user={},c.go(e.loginState)}};return e}]),angular.module("mainModule").service("security",["$rootScope","$http","$location","$state",function(a,b,c,d){return{init:function(){var b=this.hasAnyRole;a.$on("$stateChangeStart",function(a,c,e,f,g){c.data.access&&(b(c.data.access)||(a.preventDefault(),d.go("cheque.filter")))})},hasRole:function(b){var c=!1;return angular.forEach(a.user.authorities,function(a){a.authority===b&&(c=!0)}),c},hasAnyRole:function(b){var c=!1;return angular.forEach(a.user.authorities,function(a){angular.forEach(b,function(b){a.authority===b&&(c=!0)})}),c},isSameUser:function(b){return a.user.principal.username===b.username}}}]),angular.module("mainModule").factory("warning",["$rootScope","$http","$state","$mdDialog","gettextCatalog",function(a,b,c,d,e){var f={showConfirmUnsavedChanges:function(a){var b=d.confirm().title(e.getString("would you like to continue without saving changes?")).textContent(e.getString("if you do not save your changes, then all the information will be lost")).ariaLabel("unsaved changes warning").targetEvent(void 0).ok(e.getString("continue")).cancel(e.getString("cancel"));return d.show(b)},showConfirmDeletePayment:function(a){var b=d.confirm().title(e.getString("would you like to delete payment?")).textContent(e.getString("deleted payment can not be recovered")).ariaLabel("delete payment warning").targetEvent(a).ok(e.getString("delete")).cancel(e.getString("cancel"));return d.show(b)},showConfirmDeleteComment:function(a){var b=d.confirm().title(e.getString("would you like to delete comment?")).textContent(e.getString("deleted comment can not be recovered")).ariaLabel("delete comment warning").targetEvent(a).ok(e.getString("delete")).cancel(e.getString("cancel"));return d.show(b)},showConfirmDeleteCheque:function(a){var b=d.confirm().title(e.getString("would you like to delete cheque?")).textContent(e.getString("deleted cheque can not be recovered")).ariaLabel("delete cheque warning").targetEvent(a).ok(e.getString("delete")).cancel(e.getString("cancel"));return d.show(b)},showConfirmDeletePhoto:function(a){var b=d.confirm().title(e.getString("would you like to delete photo?")).textContent(e.getString("deleted photo can not be recovered")).ariaLabel("delete photo warning").targetEvent(a).ok(e.getString("delete")).cancel(e.getString("cancel"));return d.show(b)},showAlertOptimisticLockingException:function(){var a=d.alert().clickOutsideToClose(!0).title(e.getString("cheque has been changed")).textContent(e.getString("cheque has been changed by another user, please refresh the cheque and enter your changes again.")).ariaLabel("optimistic locking exception").ok(e.getString("ok"));return d.show(a)},showServerConnectionLostException:function(){var a=d.alert().clickOutsideToClose(!1).title(e.getString("server connection lost title")).textContent(e.getString("server connection lost content")).ariaLabel("server connection lost").ok(e.getString("ok"));return d.show(a)}};return f}]),angular.module("mainModule").factory("cheque",["$rootScope","$http","$state","$q","warning","$mdToast","gettextCatalog",function(a,b,c,d,e,f,g){return a.cheque={repairPeriod:99,receiptDate:moment().format("YYYY-MM-DDTHH:mm:ssZZ"),components:[],notes:[],diagnostics:[],balance:{paidStatus:!1},secretary:a.user.principal,engineer:a.user.principal},a.chequeList=[],a.balance={payments:[]},a.photoList=[],a.filter={},{createNewCheque:function(){a.cheque={repairPeriod:99,receiptDate:moment().format("YYYY-MM-DDTHH:mm:ssZZ"),components:[],notes:[],diagnostics:[],balance:{paidStatus:!1},secretary:a.user.principal,engineer:a.user.principal},a.balance={payments:[]},a.photoList=[]},getChequeListFromServer:function(c){b.post("/api/cheques/list",c).success(function(b){a.chequeList=b})},getChequeFromServer:function(c){b.get("/api/cheques/"+c).success(function(b){a.cheque=b})},deleteChequeFromServer:function(a){b["delete"]("/api/cheques/"+a).success(function(){c.go("cheque.filter"),f.show(f.simple().content(g.getString("Cheque")+" №"+a+" "+g.getString("deleted")).position("top right").hideDelay(7e3))})},syncChequeWithServer:function(c){var e=d.defer();return b.post("/api/cheques",c).success(function(b){a.cheque=b,e.resolve(!0),f.show(f.simple().content(g.getString("Cheque")+" "+g.getString("synchronized")).position("top right").hideDelay(700))}).error(function(){e.resolve(!1)}),e.promise},getDiagnosticsFromServer:function(c){b.get("/api/cheques/"+c+"/diagnostics").then(function(b){a.cheque.diagnostics=b.data})},getNotesFromServer:function(c){b.get("/api/cheques/"+c+"/notes").then(function(b){a.cheque.notes=b.data})},getChequeBalanceFromServer:function(c){b.get("/api/balance/cheque/"+c).success(function(b){a.balance=b}).error(function(){a.balance={}})},syncChequeBalanceWithServer:function(c,e){var h=d.defer();return b.post("/api/balance/cheque/"+c,e).success(function(b){h.resolve(!0),a.balance=b,f.show(f.simple().content(g.getString("payments synchronized")).position("top right").hideDelay(700))}).error(function(){h.resolve(!1)}),h.promise},getPhotoListFromServer:function(c){b.get("/api/photo/cheque/"+c).success(function(b){a.photoList=b})},deletePhotoFromServer:function(a){b["delete"]("api/photo/"+a)},addToChequeCurrentDateIfEmpty:function(b,c){a.cheque.hasOwnProperty(b)&&a.cheque[c]===!0&&(a.cheque[b]=moment().format("YYYY-MM-DDTHH:mm:ssZZ"))}}}]),angular.module("mainModule").factory("autocomplete",["$rootScope","$http",function(a,b){return a.autocomplete={customers:[],products:[],models:[],serials:[],representatives:[],emails:[],components:[],secretaries:[],engineers:[],users:[],phoneNumbers:[]},{getDataFromServer:function(c){b.get("/api/autocomplete/"+c).success(function(b){a.autocomplete[c]=b})}}}]);