angular.module("mainModule",["gettext","ui.router","angularMoment","ngMaterial","md.data.table","angular-loading-bar","templates","angular-cache","duScroll","ngFileUpload","vcRecaptcha","ngFileSaver"]).value("duScrollDuration",3e3).config(["$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider",function(e,t,n,r){r.html5Mode(!0),e.state("cheque",{abstract:!0,url:"/cheques",views:{header:{controller:["$rootScope","$scope","$state",function(e,t,n){t.selectedTab=n.current.data.selectedTab,e.$on("$stateChangeSuccess",function(e,n,r,o,a){t.selectedTab=n.data.selectedTab})}],template:'<header selected-tab="selectedTab"></header>'},content:{template:"<ui-view></ui-view>"}}}).state("cheque.filter",{url:"^/filter",template:"<filters-page></filters-page>",data:{selectedTab:0}}).state("cheque.edit",{url:"^/cheque/{chequeId:[0-9]{1,10}}",controller:["$scope","$stateParams",function(e,t){e.chequeID=t.chequeId}],template:'<cheque-page cheque-id="chequeID"></cheque-page>',data:{selectedTab:1}}).state("cheque.create",{url:"^/cheque",template:"<cheque-page></cheque-page>",data:{selectedTab:1}}).state("cheque.dashboard",{url:"^/dashboard",template:"<dashboard></dashboard>",data:{selectedTab:2,access:["ROLE_ADMIN","ROLE_BOSS","ROLE_ENGINEER"]}}).state("cheque.analytics",{url:"^/analytics",template:"<analytics-page></analytics-page>",data:{selectedTab:3,access:["ROLE_ADMIN","ROLE_BOSS"]}}).state("cheque.profile",{url:"^/profile",template:"<profile-page></profile-page>",data:{selectedTab:4,access:["ROLE_ADMIN"]}}).state("cheque.login",{url:"^/login",template:"<login-page></login-page>",data:{selectedTab:5}}),n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",n.interceptors.push(["$q","$injector",function(e,t){return{responseError:function(n){if(n.status===-1){var r=t.get("warning");return r.showServerConnectionLostException(),e.reject(n)}if(403===n.status){var o=t.get("$http"),a=e.defer();return o.get("/api/test").then(a.resolve,a.reject),a.promise.then(function(){return o(n.config)})}if("org.springframework.orm.ObjectOptimisticLockingFailureException"===n.data.exception){var r=t.get("warning");return r.showAlertOptimisticLockingException(),e.reject(n)}return e.reject(n)}}}])}]).config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("grey",{default:"900"}).accentPalette("blue-grey",{default:"900"}),e.theme("inner-block").primaryPalette("grey",{default:"50"}),e.theme("header").primaryPalette("grey",{default:"50"}).accentPalette("blue-grey",{default:"50"}).dark()}]).config(["cfpLoadingBarProvider",function(e){e.includeSpinner=!1,e.latencyThreshold=100}]).config(["$mdDateLocaleProvider",function(e){e.months="январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_"),e.shortMonths="янв_фев_март_апр_май_июнь_июль_авг_сен_окт_ноя_дек".split("_"),e.days="воскресенье_понедельник_вторник_среда_четверг_пятница_суббота".split("_"),e.shortDays="вс_пн_вт_ср_чт_пт_сб".split("_"),e.firstDayOfWeek=1,e.formatDate=function(e){return e?moment(e).format("DD.MM.YYYY"):""},e.parseDate=function(e){var t=moment(e,"DD.MM.YYYY",!0);return t.isValid()?t.toDate():new Date(NaN)}}]).run(["gettextCatalog","amMoment","auth","security","autocomplete","$rootScope",function(e,t,n,r,o,a){n.init(),r.init(),e.setCurrentLanguage("ru"),t.changeLocale("ru"),o.getDataFromServer("users"),a.tableFilter={sort:"-id",size:15,page:1}}]),angular.module("mainModule").controller("AnalyticsPage",["$scope","$http","FileSaver","Blob",function(e,t,n,r){e.columns=["engineers","brands"],e.rows=["date","cheques"],e.funds=["income","profit"],e.preferences={},e.analyticsHeader=[],e.getAnalytics=function(){t.post("/api/analytics",e.preferences,{responseType:"blob"}).success(function(e){var t=new r([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});n.saveAs(t,"analytics.xlsx")})}}]).directive("analyticsPage",function(){return{restrict:"E",controller:"AnalyticsPage",templateUrl:"app/analytics-page/analytics-page.html"}}),angular.module("mainModule").controller("ChequePage",["$rootScope","$scope","$stateParams","$http","cheque","warning","$state",function(e,t,n,r,o,a,i){t.formDirty={payment:!1,cheque:!1,comments:!1},t.hasID=!!t.chequeID,t.hasID?(o.getChequeFromServer(t.chequeID),o.getChequeBalanceFromServer(t.chequeID),o.getPhotoListFromServer(t.chequeID)):o.createNewCheque(),t.$watch("cheque.id",function(e,n){t.hasID=!!e}),e.$watch("cheque",function(e,n){t.cheque=e,t.chequeID=e.id,t.hasID=!!e.id}),e.$on("$stateChangeStart",function(e,n,r,o,c){"cheque.edit"!==o.name&&"cheque.create"!==o.name||!(t.formDirty.cheque||t.formDirty.payment||t.formDirty.comments)||(e.preventDefault(),a.showConfirmUnsavedChanges().then(function(){t.formDirty={payment:!1,cheque:!1,comments:!1},i.go(n)},function(){}))})}]).directive("chequePage",function(){return{restrict:"E",controller:"ChequePage",scope:{chequeID:"=?chequeId"},templateUrl:"app/cheque-page/cheque-page.html"}}),angular.module("mainModule").controller("Dashboard",["$scope","$stateParams","$http",function(e,t,n){n.get("/api/attention").success(function(t){e.attention=t}),n.get("/api/delay").success(function(t){e.delay=t})}]).directive("dashboard",function(){return{restrict:"E",controller:"Dashboard",templateUrl:"app/dashboard/dashboard.html"}}),angular.module("mainModule").directive("filtersPage",function(){return{restrict:"E",templateUrl:"app/filters-page/filters-page.html"}}),angular.module("mainModule").controller("Header",["$scope","currencyRatesService","$mdToast","$rootScope","auth","gettextCatalog","security",function(e,t,n,r,o,a,i){t.getCurrencyRate(),e.refreshCurrencyRates=function(){t.refreshCurrencyRate(),n.show(n.simple().content("Currency rates refreshed").position("top right").hideDelay(700))},e.authenticated=function(){return o.authenticated},e.profileName=function(){return r.user.principal&&r.user.principal.fullname?r.user.principal.fullname:a.getString("profile")},e.security=i,e.logout=o.logout}]).directive("header",function(){return{restrict:"E",controller:"Header",scope:{selectedTab:"=selectedTab"},require:"selectedTab",templateUrl:"app/header/header.html"}}),angular.module("mainModule").controller("LoginPage",["$scope","$rootScope","auth","$mdToast","vcRecaptchaService","autocomplete",function(e,t,n,r,o,a){e.credentials={},e.response=null,e.widgetId=null,e.model={key:"6Le_FBETAAAAABTCTvoZWEEIqb1lxqNpNAtRlGWk"},e.authenticated=function(){return n.authenticated},e.login=function(){n.authenticate(e.credentials,e.response).then(function(t){t?(a.getDataFromServer("users"),r.show(r.simple().content("Login succeeded").position("top right").hideDelay(700))):(r.show(r.simple().content("Login failed").position("top right").hideDelay(700)),o.reload(e.widgetId))})},e.logout=n.logout,e.hasAccess=function(n){var r=!1;return angular.forEach(t.user.authorities,function(e){e.authority===n&&(r=!0)}),r&&e.authenticated()},e.setResponse=function(t){e.response=t},e.setWidgetId=function(t){e.widgetId=t},e.cbExpiration=function(){e.response=null}}]).directive("loginPage",function(){return{restrict:"E",controller:"LoginPage",templateUrl:"app/login-page/login-page.html"}}),angular.module("mainModule").controller("ProfilePage",["$scope","$http","currencyRatesService",function(e,t,n){var r={username:"Name",fullname:"FullName",enabled:!0,authorities:[{authority:"ROLE_ENGINEER"}]};n.getListOfCurrencyRates().then(function(t){e.rates=t}),e.setRates=function(){n.setListOfCurrencyRates(e.rates)},e.getUsers=function(){t.get("/api/users").success(function(t){e.users=t})},e.addUser=function(){e.users.push(r)},e.getUsers()}]).directive("profilePage",function(){return{restrict:"E",controller:"ProfilePage",templateUrl:"app/profile-page/profile-page.html"}}),angular.module("mainModule").controller("ChequeForm",["$scope","$http","gettextCatalog","$mdToast","$state","security","$rootScope","warning","$document","cheque","autocomplete","$timeout",function(e,t,n,r,o,a,i,c,u,s,l,m){e.disableChequeForm=!a.hasAnyRole(["ROLE_ADMIN","ROLE_BOSS","ROLE_SECRETARY"]),e.security=a,e.getAutocompleteData=l.getDataFromServer,e.currentDateIfEmpty=s.addToChequeCurrentDateIfEmpty,e.cleanDateIfOff=s.cleanDateIfOff,e.syncCheque=function(){s.syncChequeWithServer(e.cheque).then(function(t){t&&(e.chequeForm.$setPristine(),e.chequeForm.$setUntouched(),s.getChequeBalanceFromServer(i.cheque.id))})},e.deleteCheque=function(t){c.showConfirmDeleteCheque(t).then(function(){e.$parent.formDirty={payment:!1,cheque:!1},s.deleteChequeFromServer(e.cheque.id)},function(){})},e.addKit=function(e){return{name:e}},e.syncWithReadyStatus=function(){e.cheque.readyStatus=e.cheque.withoutRepair,e.currentDateIfEmpty("readyDate","readyStatus")},e.syncWithWithoutRepairStatus=function(){var t=e.cheque.readyStatus,n=e.cheque.withoutRepair;t===!1&&n===!0&&(e.cheque.withoutRepair=t)},e.printCheque=function(){window.print()},m(function(){e.chequeForm.$setPristine(),e.$watch("chequeForm.$dirty",function(t,n){e.$parent.formDirty.cheque=t})},1e3)}]).directive("chequeForm",[function(){return{restrict:"E",controller:"ChequeForm",scope:{cheque:"=ngModel",hasID:"=hasId"},require:["ngModel","hasId"],templateUrl:"app/cheque-page/cheque-form/cheque-form.html"}}]),angular.module("mainModule").controller("CommentsBlock",["$scope","$http","$document","$rootScope","security","warning","cheque",function(e,t,n,r,o,a,i){e.comment=void 0,e.add=3,e.limit=3,e.bottomButton="show more",e.saveComment=function(){e.comment.user=r.user.principal,e.comment.cheque=e.cheque,t.post("/api/cheques/"+e.cheque.id+"/"+e.type,e.comment).success(function(){e.comment.text=void 0,e.commentsForm.$setPristine(),e.commentsForm.$setUntouched(),"diagnostics"===e.type&&i.getDiagnosticsFromServer(e.cheque.id),"notes"===e.type&&i.getNotesFromServer(e.cheque.id)})},e.deleteComment=function(n,r){a.showConfirmDeleteComment(r).then(function(){t.delete("/api/cheques/"+e.cheque.id+"/"+e.type+"/"+n).success(function(){"diagnostics"===e.type&&i.getDiagnosticsFromServer(e.cheque.id),"notes"===e.type&&i.getNotesFromServer(e.cheque.id)})},function(){})},e.addedLesserThanElem=function(){if(e.cheque[e.type])return e.add<e.cheque[e.type].length};var c=function(){return e.limit<e.cheque[e.type].length};e.limitComments=function(){c()?e.limit+=e.add:e.limit=e.add,c()?e.bottomButton="show more":e.bottomButton="roll up"},e.$watch("commentsForm.$dirty",function(t,n){e.$parent.formDirty.comments=t}),e.security=o}]).directive("commentsBlock",[function(){return{restrict:"E",controller:"CommentsBlock",scope:{cheque:"=ngModel",type:"=type"},require:"ngModel",templateUrl:"app/cheque-page/comments-block/comments-block.html"}}]),angular.module("mainModule").controller("PaymentBlock",["$rootScope","$scope","currencyRatesService","security","warning","$http","$mdToast","gettextCatalog","cheque","$state",function(e,t,n,r,o,a,i,c,u,s){t.hasPrepayment=!1,t.balance={payments:[]},t.security=r,t.hasAtLeastOnePayment=function(){return t.balance.payments.length>0},t.synchronizeBalance=function(){u.syncChequeBalanceWithServer(t.chequeID,t.balance).then(function(e){e&&(t.paymentForm.$setPristine(),t.paymentForm.$setUntouched())})},t.addPayment=function(){void 0===t.balance.payments&&(t.balance.payments=[]),n.refreshCurrencyRate(),t.balance.payments.push({cost:0,currency:"rub",exchangeRate:e.currencyRates,user:e.user.principal})},t.delPayment=function(e,n){o.showConfirmDeletePayment(n).then(function(){t.balance.payments.splice(t.balance.payments.indexOf(e),1),t.paymentForm.$setDirty()},function(){})},t.sum=function(e,n){var r=0;return t.hasPrepayment=!1,void 0!=t.balance.payments&&t.balance.payments.forEach(function(o){void 0!=o.cost&&void 0!=o.currency&&("prepayment"!=o.type?r+=o.cost*o.exchangeRate[o.currency]/o.exchangeRate[e]:(t.hasPrepayment=!0,n&&(r-=o.cost*o.exchangeRate[o.currency]/o.exchangeRate[e])))}),r},t.$watch("paymentForm.$dirty",function(e,n){t.$parent.formDirty.payment=e}),e.$watch("balance",function(e,n){void 0!==e&&(t.balance=e)})}]).directive("paymentBlock",[function(){return{restrict:"E",controller:"PaymentBlock",scope:{chequeID:"=chequeId"},require:"chequeId",templateUrl:"app/cheque-page/payment-block/payment-block.html"}}]),angular.module("mainModule").directive("printCheque",function(){return{restrict:"E",controller:["$scope",function(e){var t={office:{office:!0,tech:!1,client:!1},tech:{office:!1,tech:!0,client:!1},client:{office:!1,tech:!1,client:!0}};e.spec=t[e.specialization],e.getComponents=function(){var t=[];return e.cheque.components.forEach(function(e){t.push(e.name)}),t.join(", ")}}],scope:{cheque:"=ngModel",specialization:"=specialization"},require:["ngModel","specialization"],templateUrl:"app/cheque-page/print-cheque/print-cheque.html"}}),angular.module("mainModule").controller("PhotoBlock",["$scope","Upload","$http","$state","$location","$rootScope","warning","cheque","$window","security",function(e,t,n,r,o,a,i,c,u,s){e.security=s,e.deletePhoto=function(t,r){i.showConfirmDeletePhoto(r).then(function(){n.delete("api/photo/"+e.chequeID+"/"+t).success(function(){c.getPhotoListFromServer(e.chequeID)})},function(){})},e.openPhoto=function(e){u.open("/api/photo/"+e,"_blank")},e.$watch("files",function(){e.upload(e.files)}),e.$watch("file",function(){null!=e.file&&(e.files=[e.file])}),e.upload=function(n){if(n&&n.length)for(var r=0;r<n.length;r++){var o=n[r];o.$error||t.upload({url:"/api/upload-image",data:{file:o,chequeID:e.chequeID,username:a.user.principal.username}}).success(function(){c.getPhotoListFromServer(e.chequeID)})}}}]).directive("photoBlock",[function(){return{restrict:"E",controller:"PhotoBlock",scope:{chequeID:"=chequeId"},require:"chequeId",templateUrl:"app/cheque-page/photo-block/photo-block.html"}}]),angular.module("mainModule").controller("FilterForm",["$rootScope","$scope","$http","$timeout","$mdDialog","gettextCatalog","$q","cheque","autocomplete",function(e,t,n,r,o,a,i,c,u){t.filterForm={},t.getAutocompleteData=u.getDataFromServer,t.resetFilter=function(){e.filter=angular.copy({}),t.filterForm.$setPristine()},t.sendFilterPreferences=function(){e.tableFilter.page=1,e.currentFilter=e.filter,c.getChequeListFromServer()}}]).directive("filterForm",function(){return{restrict:"E",controller:"FilterForm",templateUrl:"app/filters-page/filter-form/filter-form.html"}}),angular.module("mainModule").filter("filterByDateRange",[function(){return function(e,t,n){if(null==t&&null==n)return e;var r=null!=t?moment(t).unix():moment("1899-12-31T21:00:00.000Z").unix(),o=null!=n?moment(n).unix():moment("2999-12-31T21:00:00.000Z").unix(),a=null,i=[];return angular.forEach(e,function(e){a=moment(e.receiptDate).unix(),r<a&&a<o&&i.push(e)}),i}}]),angular.module("mainModule").filter("filterByID",[function(){return function(e,t){if(null==t||""==t)return e;var n=[];return angular.forEach(e,function(e){t==e.id&&n.push(e)}),n}}]),angular.module("mainModule").controller("TableData",["$rootScope","$scope","$http","$timeout","$mdDialog","gettextCatalog","$state","cheque",function(e,t,n,r,o,a,i,c){t.label={page:"Страница",rowsPerPage:a.getString("Rows per page:"),of:a.getString("of")},t.mdOnPaginate=c.getChequeListFromServer,t.mdOnReorder=c.getChequeListFromServer,t.open=function(e,t){(2===e.which||1===e.which&&(e.metaKey||e.ctrlKey))&&window.open(i.href("cheque.edit",{chequeId:t},{absolute:!0}),"_blank")}}]).directive("tableData",function(){return{restrict:"E",controller:"TableData",templateUrl:"app/filters-page/table-data/table-data.html"}}),angular.module("mainModule").controller("CurrencyRateDay",["$scope","$http",function(e,t){e.sendRate=function(){t.post("/api/currency-rate",e.rate).success(function(){e.day.$setPristine()})}}]).directive("currencyRateDay",function(){return{restrict:"E",controller:"CurrencyRateDay",scope:{rate:"=ngModel"},require:"ngModel",templateUrl:"app/profile-page/currency-rate-day/currency-rate-day.html"}}),angular.module("mainModule").controller("UserDetails",["$scope","$http","currencyRatesService",function(e,t,n){e.saveUser=function(){t.post("/api/user",e.user).success(function(){e.$parent.getUsers()})},e.addAuthority=function(e){return{authority:e}}}]).directive("userDetails",function(){return{restrict:"E",controller:"UserDetails",scope:{user:"=ngModel"},require:"ngModel",templateUrl:"app/profile-page/user-details/user-details.html"}}),angular.module("mainModule").controller("PaymentLine",["$scope","$http","security",function(e,t,n){e.$watch("payment.type",function(t,n){e.hasPrepayment="prepayment"===t}),e.$watch("paid",function(t,n){e.paymentLineDisabled=t||!e.security.hasAnyRole(["ROLE_ADMIN","ROLE_BOSS"])&&!e.security.isSameUser(e.payment.user)}),e.toPay=function(t){return e.payment.cost*e.payment.exchangeRate[e.payment.currency]/e.payment.exchangeRate[t]},e.loadUsers=function(){t.get("/api/users").success(function(t){e.users=t})},e.hasPrepayment=!1,e.types=["repair","zip","deliver","prepayment"],e.currencies=["eur","uah","usd","rub"],e.security=n}]).directive("paymentLine",[function(){return{restrict:"E",controller:"PaymentLine",scope:{payment:"=payment",paid:"=paid"},require:["ngModel","paid"],templateUrl:"app/cheque-page/payment-block/payment-line/payment-line.html"}}]),angular.module("mainModule").controller("TimePicker",["$scope",function(e){e.$watch("time",function(t,n){void 0==t?(e.hours=void 0,e.minutes=void 0):(e.hours=moment(t).format("HH"),e.minutes=moment(t).format("mm"))}),e.$watch("hours",function(t,n){void 0!=t&&(e.time=moment(e.time).hours(t).format("YYYY-MM-DDTHH:mm:ssZZ"))}),e.$watch("minutes",function(t,n){void 0!=t&&(e.time=moment(e.time).minutes(t).format("YYYY-MM-DDTHH:mm:ssZZ"))})}]).directive("timePicker",function(){return{restrict:"E",controller:"TimePicker",scope:{time:"=ngModel"},require:"ngModel",templateUrl:"directives/time-picker/time-picker.html"}}),angular.module("mainModule").controller("DateTimePicker",["$scope",function(e){e.$watch("datetime",function(t,n){void 0==t?(e.datetimeinner=void 0,e.date=void 0,e.time=void 0):(e.date=moment(t).toDate(),e.time=moment(t).toDate())}),e.$watch("date",function(t,n){if(void 0!=t){var r=moment(e.datetime).hours(),o=moment(e.datetime).minutes();e.datetime=moment(t).hours(r).minutes(o).format("YYYY-MM-DDTHH:mm:ssZZ")}}),e.$watch("time",function(t,n){if(void 0!=t){var r=moment(t).hours(),o=moment(t).minutes();e.datetime=moment(e.datetime).hours(r).minutes(o).format("YYYY-MM-DDTHH:mm:ssZZ")}})}]).directive("dateTimePicker",function(){return{restrict:"E",controller:"DateTimePicker",scope:{datetime:"=ngModel",disableChequeForm:"=ngDisabled"},require:"ngModel",templateUrl:"directives/date-time-picker/date-time-picker.html"}}),angular.module("mainModule").controller("DatePicker",["$scope",function(e){e.$watch("date",function(t,n){void 0==t?e.dateInner=void 0:e.dateInner=moment(t).toDate()}),e.$watch("dateInner",function(t,n){void 0!=t&&(e.date=moment(t).format("YYYY-MM-DDTHH:mm:ssZZ"))})}]).directive("datePicker",function(){return{restrict:"E",controller:"DatePicker",scope:{date:"=ngModel",disabled:"=ngDisabled",placeholder:"=mdPlaceholder"},require:["ngModel","ngDisabled"],templateUrl:"directives/date-picker/date-picker.html"}}),angular.module("mainModule").factory("auth",["$rootScope","$http","$state","$q",function(e,t,n,r){e.user={};var o={authenticated:!1,loginState:"cheque.login",logoutPath:"/logout",desireState:"cheque.filter",desireParams:{},init:function(){o.authenticate({},{}).then(function(e){e||n.go(o.loginState)}),e.$on("$stateChangeStart",function(e,t,n,r,a){t.name===o.loginState||o.authenticated||(o.desireState=t.name,o.desireParams=n,e.preventDefault())})},authenticate:function(a,i){var c=r.defer(),u=a&&a.username?{Authorization:"Basic "+btoa(a.username+":"+a.password)}:{};return u.ReCaptcha=i,t.get("/api/user",{headers:u,params:{"remember-me":!0}}).success(function(t){e.user=t,o.authenticated=!!t.name,n.go(o.desireState,o.desireParams),c.resolve(o.authenticated)}).error(function(){c.resolve(!1),o.authenticated=!1}),c.promise},logout:function(){t.post(o.logoutPath,{}),o.authenticated=!1,e.user={},n.go(o.loginState)}};return o}]),angular.module("mainModule").factory("autocomplete",["$rootScope","$http",function(e,t){return e.autocomplete={customers:[],products:[],models:[],serials:[],representatives:[],emails:[],components:[],secretaries:[],engineers:[],users:[],phoneNumbers:[]},{getDataFromServer:function(n){t.get("/api/autocomplete/"+n).success(function(t){e.autocomplete[n]=t})}}}]),angular.module("mainModule").factory("cheque",["$rootScope","$http","$state","$q","warning","$mdToast","gettextCatalog",function(e,t,n,r,o,a,i){function c(e){return e.indexOf("-")!==-1?(e=e.substr(1),e+=",desc"):e+=",asc",e}return e.cheque={repairPeriod:99,receiptDate:moment().format("YYYY-MM-DDTHH:mm:ssZZ"),components:[],notes:[],diagnostics:[],balance:{paidStatus:!1},secretary:e.user.principal,engineer:e.user.principal},e.chequeList=[],e.balance={payments:[]},e.photoList=[],e.filter={customerName:null,engineer:null,model:null,phoneNumber:null,productName:null,representativeName:null,secretary:null,serialNumber:null},e.currentFilter={},e.page={},{createNewCheque:function(){e.cheque={repairPeriod:99,receiptDate:moment().format("YYYY-MM-DDTHH:mm:ssZZ"),components:[],notes:[],diagnostics:[],balance:{paidStatus:!1},secretary:e.user.principal,engineer:e.user.principal},e.balance={payments:[]},e.photoList=[]},getChequeListFromServer:function(){var n={page:e.tableFilter.page-1,size:e.tableFilter.size,sort:c(e.tableFilter.sort)};t.post("/api/cheques/list",e.currentFilter,{params:n}).success(function(t){e.page=t})},getChequeFromServer:function(n){t.get("/api/cheques/"+n).success(function(t){e.cheque=t})},deleteChequeFromServer:function(e){t.delete("/api/cheques/"+e).success(function(){n.go("cheque.filter"),a.show(a.simple().content(i.getString("Cheque")+" №"+e+" "+i.getString("deleted")).position("top right").hideDelay(7e3))})},syncChequeWithServer:function(n){var o=r.defer();return t.post("/api/cheques",n).success(function(t){e.cheque=t,o.resolve(!0),a.show(a.simple().content(i.getString("Cheque")+" "+i.getString("synchronized")).position("top right").hideDelay(700))}).error(function(){o.resolve(!1)}),o.promise},getDiagnosticsFromServer:function(n){t.get("/api/cheques/"+n+"/diagnostics").then(function(t){e.cheque.diagnostics=t.data})},getNotesFromServer:function(n){t.get("/api/cheques/"+n+"/notes").then(function(t){e.cheque.notes=t.data})},getChequeBalanceFromServer:function(n){t.get("/api/balance/cheque/"+n).success(function(t){e.balance=t}).error(function(){e.balance={}})},syncChequeBalanceWithServer:function(n,o){var c=r.defer();return t.post("/api/balance/cheque/"+n,o).success(function(t){c.resolve(!0),e.balance=t,a.show(a.simple().content(i.getString("payments synchronized")).position("top right").hideDelay(700))}).error(function(){c.resolve(!1)}),c.promise},getPhotoListFromServer:function(n){t.get("/api/photo/cheque/"+n).success(function(t){e.photoList=t})},deletePhotoFromServer:function(e){t.delete("api/photo/"+e)},addToChequeCurrentDateIfEmpty:function(t,n){e.cheque.hasOwnProperty(t)&&e.cheque[n]===!0?e.cheque[t]=moment().format("YYYY-MM-DDTHH:mm:ssZZ"):e.cheque[t]=void 0},cleanDateIfOff:function(t,n){e.cheque.hasOwnProperty(t)&&e.cheque[n]===!0||(e.cheque[t]=void 0)}}}]),angular.module("mainModule").service("currencyRatesService",["CacheFactory","$http","$q","$rootScope",function(e,t,n,r){var o;return e.get("currencyRatesCache")||e.createCache("currencyRatesCache",{deleteOnExpire:"aggressive",maxAge:288e5,recycleFreq:6e4,storageMode:"localStorage",onExpire:function(e,n){t.get(e).success(function(t){o.put(e,t)})}}),o=e.get("currencyRatesCache"),{getCurrencyRate:function(){t.get("/api/currency-rate",{cache:o}).success(function(e){r.currencyRates=e})},refreshCurrencyRate:function(){o.remove("/api/currency-rate"),this.getCurrencyRate()},getListOfCurrencyRates:function(){var e=n.defer();return t.get("/api/currency-rate-list").success(function(t){e.resolve(t)}),e.promise},setListOfCurrencyRates:function(e){t.post("/api/currency-rate-list",e)}}}]),angular.module("mainModule").service("security",["$rootScope","$http","$location","$state",function(e,t,n,r){return{init:function(){var t=this.hasAnyRole;e.$on("$stateChangeStart",function(e,n,o,a,i){n.data.access&&(t(n.data.access)||(e.preventDefault(),r.go("cheque.filter")))})},hasRole:function(t){var n=!1;return angular.forEach(e.user.authorities,function(e){e.authority===t&&(n=!0)}),n},hasAnyRole:function(t){var n=!1;return angular.forEach(e.user.authorities,function(e){angular.forEach(t,function(t){e.authority===t&&(n=!0)})}),n},isSameUser:function(t){return e.user.principal.username===t.username}}}]),angular.module("mainModule").factory("warning",["$rootScope","$http","$state","$mdDialog","gettextCatalog",function(e,t,n,r,o){var a={showConfirmUnsavedChanges:function(e){var t=r.confirm().title(o.getString("would you like to continue without saving changes?")).textContent(o.getString("if you do not save your changes, then all the information will be lost")).ariaLabel("unsaved changes warning").targetEvent(void 0).ok(o.getString("continue")).cancel(o.getString("cancel"));return r.show(t)},showConfirmDeletePayment:function(e){var t=r.confirm().title(o.getString("would you like to delete payment?")).textContent(o.getString("deleted payment can not be recovered")).ariaLabel("delete payment warning").targetEvent(e).ok(o.getString("delete")).cancel(o.getString("cancel"));return r.show(t)},showConfirmDeleteComment:function(e){var t=r.confirm().title(o.getString("would you like to delete comment?")).textContent(o.getString("deleted comment can not be recovered")).ariaLabel("delete comment warning").targetEvent(e).ok(o.getString("delete")).cancel(o.getString("cancel"));return r.show(t)},showConfirmDeleteCheque:function(e){var t=r.confirm().title(o.getString("would you like to delete cheque?")).textContent(o.getString("deleted cheque can not be recovered")).ariaLabel("delete cheque warning").targetEvent(e).ok(o.getString("delete")).cancel(o.getString("cancel"));return r.show(t)},showConfirmDeletePhoto:function(e){var t=r.confirm().title(o.getString("would you like to delete photo?")).textContent(o.getString("deleted photo can not be recovered")).ariaLabel("delete photo warning").targetEvent(e).ok(o.getString("delete")).cancel(o.getString("cancel"));return r.show(t)},showAlertOptimisticLockingException:function(){var e=r.alert().clickOutsideToClose(!0).title(o.getString("cheque has been changed")).textContent(o.getString("cheque has been changed by another user, please refresh the cheque and enter your changes again.")).ariaLabel("optimistic locking exception").ok(o.getString("ok"));return r.show(e)},showServerConnectionLostException:function(){var e=r.alert().clickOutsideToClose(!1).title(o.getString("server connection lost title")).textContent(o.getString("server connection lost content")).ariaLabel("server connection lost").ok(o.getString("ok"));return r.show(e)}};return a}]),angular.module("gettext").run(["gettextCatalog",function(e){e.setStrings("ru",{Address:"Адрес","Change cheque №":"Изменить расписку №",notes:"Специальные отметки","new cheques":"Новые расписки",Customer:"Заказчик",Email:"Почта",Guarantee:"Гарантия (д/н)",help:"Помощь",Home:"Главная",Id:"№",Inspector:"Принял",Introduced:"Прием",IntroducedFrom:"Принят с",IntroducedTo:"Принят по",Issued:"Выдан (д/н)","Is Issued":"Выдан",Kits:"Комплект",Malfunction:"Неисправность",master:"Инженер",Model:"Модель","Modify Check":"Править","Name of Product":"Наименование",No:"Нет","Number of pages":"Количество страниц",Phone:"Телефон",profile:"Профиль",Purchaser:"Сдал",Ready:"Готов (д/н)","Is Ready":"Готов","Repair Period":"Срок ремонта",Send:"Добавить","Serial Number":"Серийный номер",settings:"Настройки","Special Notes":"Особые отметки",diagnostics:"Диагностика",Yes:"Да",Filters:"Фильтры",Checks:"Расписки",Create:"Создать","Change cheque":"Изменить расписку",Now:"Сейчас",Cancel:"Закрыть",save:"Применить",Cheque:"Расписка",added:"добавлена",modified:"изменена",deleted:"удалена","Has guarantee":"Есть гарантия",Warranty:"Гарантия","Has no guarantee":"Нет гарантии","Not ready":"Не готов","Not issued":"Не выдан","Rows per page:":"Строк на странице:",of:"из",tasks:"Задачи",login:"Войти",logout:"Выйти",tasks:"Задачи",analytics:"Аналитика",synchronize:"Синхронизировать",synchronized:"синхронизирована","enter date":"Введите дату",cheque:"Расписка",Paid:"Оплачен (д/н)","Is Paid":"Оплачен","Not Paid":"Не оплачен",payment:"Оплата",repair:"Ремонт",zip:"ЗИП",deliver:"Доставка",prepayment:"Предоплата",type:"Тип",description:"Описание",cost:"Стоимость",currency:"Валюта",sum:"Сумма","sum with prepayment":"Сумма с предоплатой","estimated cost":"Ориентировочная цена","currency rates":"Курс валют","show more":"Показать ещё","roll up":"Свернуть",authorization:"Авторизация",username:"Логин",password:"Пароль",users:"Пользователи","cheques with delay":"Расписки с просрочкой","new cheque":"Новая расписка",photographies:"Фотографии","drop photographies here":"Поместите фотографии сюда","would you like to continue without saving changes?":"Выйти без сохранения изменений?","if you do not save your changes, then all the information will be lost":"Если не сохранить изменения, то вся информация будет потеряна",continue:"Продолжить",cancel:"Отмена","would you like to delete payment?":"Удалить счет?","deleted payment can not be recovered":"Удаленный счет невозможно восстановить",delete:"Удалить","would you like to delete comment?":"Удалить комментарий?","deleted comment can not be recovered":"Удаленный комментарий невозможно восстановить","would you like to delete cheque?":"Удалить расписку?","deleted cheque can not be recovered":"Удаленную расписку невозможно восстановить","would you like to delete photo?":"Удалить фото?","deleted photo can not be recovered":"Удаленное фото невозможно восстановить","payments synchronized":"Оплата синхронизирована","cheque has been changed":"Расписка была изменена другим пользователем","cheque has been changed by another user, please refresh the cheque and enter your changes again.":"Пожалуйста, обновите расписку и внесите свои изменения снова",find:"Найти",fullname:"Полное имя","new password":"Новый пароль","admin password":"Пароль администратора",enabled:"Включен","server connection lost title":"Соединение с сервером потеряно","server connection lost content":"Случилось страшное: сервер не отвечает на запросы. Попробуйте обновить страницу через несколько минут.",receipt:"принята",returnedToClientFrom:"Выдан с",returnedToClientTo:"Выдан по","Without Repair":"Без ремонта (д/н)","Is Without Repair":"Без ремонта","With Repair":"С ремонтом"})}]);